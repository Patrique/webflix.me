var app={version:"0.3.0",maxBufferPercentage:15,status:"starting",installed:!1,connected:!1,watching:!1,currentHash:"*",btapp:{},player:{videojs:{},projekktor:{}}};
(function(c){c.fn||(c.fn={});c=c.fn;c.closeDetails=function(){var c=$("#movie-details, #tv-details").filter(":visible");app.nav.switchView(c.data("previous-view"));c.data("previous-view",null);_.each(c.find("*"),function(b){b=$(b);b.data("query-ids")&&app.queries.cancel(b)});c.animate({width:"hide"}).find("#movie-details-foreground, #tv-details-foreground").fadeOut();$("#tv-details-episodes").slideUp();$("#tv-details-desc").slideDown();document.title="webflix.me"};c.connectToTorque=function(){app.btapp=
new Btapp;app.btapp.connect({product:"Torque"});fn.setup.torqueMessageReciever();app.btapp.on("client:connected",function(){$("#setup-modal").is(":visible")&&$("#setup-modal, #modal-bg").fadeOut();$("#first-run").val("0").trigger("change");app.torrents.updateAll()});app.btapp.live("settings default_download_directory",function(c,b){var e=$("#default-download-directory");""==e.val()&&e.val(c).trigger("change")});app.btapp.live("settings max_dl_rate",function(c,b){var e=$("#max-download-speed");"0"==
e.val()&&e.val(c).trigger("change")});app.btapp.live("settings max_ul_rate",function(c,b){var e=$("#max-upload-speed");"0"==e.val()&&e.val(c).trigger("change")})};c.openModal=function(c){var b=$("#modal-bg");b.is(":visible")&&b.click();b.data("previous-view",app.nav.currentView());b.attr("data-modal",c);$(c+", #modal-bg").fadeIn()};c.status=function(c,b,e){"string"===typeof b?($("#status-progress").show().find(".bar").css("width",b),$("#status-loading-indicator").hide()):($("#status-progress").hide(),
$("#status-loading-indicator").show());if(e)$("#status-cancel").show().on("click",e);else $("#status-cancel").hide().unbind("click");!1===c?$("#status").fadeOut():$("#status").fadeIn().find("#status-text").html(c)};c.stopDownloads=function(){if(app.connected){var c=$("#keep-downloaded-files").is(":checked");if(app.currentHash&&"*"!==app.currentHash){var b=app.btapp.get("torrent").get(app.currentHash);b.stop();c||b.remove(Btapp.TORRENT.REMOVE.DELETE_TORRENT_AND_DATA)}app.btapp.get("torrent").each(function(b){b.stop();
c||b.remove(Btapp.TORRENT.REMOVE.DELETE_TORRENT_AND_DATA)})}}})(window);
(function(c){c.api||(c.api={});c=c.api;var g="udp://open.demonii.com:1337 udp://tracker.istole.it:80 http://tracker.yify-torrents.com/announce udp://tracker.publicbt.com:80 udp://tracker.openbittorrent.com:80 udp://tracker.coppersurfer.tk:6969 udp://exodus.desync.com:6969 http://exodus.desync.com:6969/announce".split(" "),b=function(a){if(!a.url)throw Error("No URL specified");var d=_.map(a.data,function(a,d){return d+"="+a}).join("&");0<_.size(a.data)&&(d="?"+d);d="http://query.yahooapis.com/v1/public/yql?q="+
encodeURIComponent("select content from data.headers where url='"+encodeURI(a.url+d).replace(/[!,'()*]/g,"")+"'")+"&format=json&env="+encodeURIComponent("store://datatables.org/alltableswithkeys");return $.getJSON(d,function(d){try{var b=d.query.results}catch(c){console.warn("Invalid JSON data returned");"function"===typeof a.error&&a.error("Invalid JSON data returned",d);"function"===typeof a.complete&&a.complete("Invalid JSON data returned",d);return}try{b=b.resources.content}catch(f){console.warn("No data returned");
"function"===typeof a.error&&a.error("No data returned",d);"function"===typeof a.complete&&a.complete("No data returned",d);return}b?(b=b.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,""),"function"===typeof a.success&&a.success(b),"function"===typeof a.complete&&a.complete(b)):(console.warn("No data returned"),"function"===typeof a.error&&a.error("No data returned",d),"function"===typeof a.complete&&a.complete("No data returned",d))})},e=function(a){if(!a.url)throw Error("No URL specified");var d=
_.map(a.data,function(a,d){return d+"="+a}).join("&");0<_.size(a.data)&&(d="?"+d);d="http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent("select content from data.headers where url='"+encodeURI(a.url+d).replace(/[!,'()*]/g,"")+"'")+"&format=json&env="+encodeURIComponent("store://datatables.org/alltableswithkeys");return $.getJSON(d,function(d){try{var b=d.query.results}catch(c){console.warn("Invalid JSON data returned");"function"===typeof a.error&&a.error("Invalid JSON data returned",
d);"function"===typeof a.complete&&a.complete("Invalid JSON data returned",d);return}try{b=b.resources.content.json}catch(f){console.warn("No data returned");"function"===typeof a.error&&a.error("No data returned",d);"function"===typeof a.complete&&a.complete("No data returned",d);return}b?("function"===typeof a.success&&a.success(b),"function"===typeof a.complete&&a.complete(b)):(console.warn("No data returned"),"function"===typeof a.error&&a.error("No data returned",d),"function"===typeof a.complete&&
a.complete("No data returned",d))})},n=function(a){var d={};d.imdbId=a.imdb_id;d.tmdbId=a.id;d.title=a.title||"";d.year=(a.release_date||"").split("-")[0];d.description=a.overview||"";d.rating=a.vote_average||"";d.posterImage="";a.poster_path&&(d.posterImage="http://image.tmdb.org/t/p/w300"+a.poster_path);d.backdropImage="";a.backdrop_path&&(d.backdropImage="http://image.tmdb.org/t/p/w1280"+a.backdrop_path);d.runtime="";a.runtime&&(d.runtime=a.runtime+"m");d.cast=_.pluck(a.credits.cast.splice(0,3),
"name");d.genres=_.pluck(a.genres,"name");0<a.trailers.youtube.length&&(d.trailer=a.trailers.youtube[0].source);d.similar=_.map(a.similar_movies.results,function(a){return{tmdbId:a.id}});return d},m=function(a){return{name:"",quality:a.quality,seeds:a.seeds,peers:a.peers,size:a.size_bytes,url:"magnet:?xt=urn:btih:"+a.hash+"&tr="+g.join("&tr=")}},l=function(a){var d={};d.imdbId=a.external_ids.imdb_id;d.tmdbId=a.id;d.title=a.name||"";d.year=(a.first_air_date||"").split("-")[0];d.description=a.overview||
"";d.rating=a.vote_average||"";d.posterImage="";a.poster_path&&(d.posterImage="http://image.tmdb.org/t/p/w300"+a.poster_path);d.backdropImage="";a.backdrop_path&&(d.backdropImage="http://image.tmdb.org/t/p/w1280"+a.backdrop_path);d.runtime="";0<a.episode_run_time.length&&(d.runtime=a.episode_run_time[0]+"m");d.cast=_.pluck(a.credits.cast.splice(0,3),"name");d.genres=_.pluck(a.genres,"name");d.seasons=_.map(a.seasons,function(a){return{tmdbId:a.id,number:a.season_number,episodeCount:a.episode_count}});
d.similar=_.map(a.similar.results,function(a){return{tmdbId:a.id}});return d},f=function(a){var d={};d.tmdbId=a.id;d.title=a.name||"";d.number=a.episode_number;d.airDate=a.air_date||"";d.description=a.overview||"";d.stillImage="";a.still_path&&(d.stillImage="http://image.tmdb.org/t/p/w300"+a.still_path);return d},h=function(a){var d={};a=_.pick(a,"keywords","genre","sort","sortOrder","page");a.keywords&&(d.query_term=a.keywords);a.genre&&(d.genre=a.genre);a.sort&&(d.sort_by={popularity:"seeds",date:"year",
rating:"rating"}[a.sort]);a.sortOrder&&(d.order_by=a.sortOrder);a.page&&(d.page=a.page);return d},k=function(a){var d={api_key:"f2d9fc51f6de779fb245cb121166eb5a"},b;a=_.pick(a,"keywords","genre","sort","sortOrder","page");if("string"===typeof a.keywords&&0<a.keywords.length)b="search/tv",d.query=a.keywords;else{b="discover/tv";a.genre&&(d.with_genres={Action:28,Adventure:12,Animation:16,Comedy:35,Crime:80,Documentary:99,Drama:18,Family:10751,Fantasy:14,Foreign:10769,History:36,Horror:27,Music:10402,
Mystery:9648,Romance:10749,"Science Fiction":878,"TV Movie":10770,Thriller:53,War:10752,Western:37,"Action & Adventure":10759,Education:10761,Kids:10762,News:10763,Reality:10764,"Sci-Fi & Fantasy":10765,Soap:10766,Talk:10767,"War & Politics":10768}[a.genre]);a.sort&&(d.sort_by={popularity:"popularity",date:"first_air_date",rating:"vote_average"}[a.sort]+"."+(a.sortOrder||"desc"),"vote_average"!==d.sort_by.split(".")[0]||a.keywords&&0!==a.keywords.length||(d["vote_count.gte"]=15));var c=new Date,f=
c.getUTCMonth()+1,f=10>f?"0"+f:f,e=c.getUTCDate(),e=10>e?"0"+e:e;d["first_air_date.lte"]=c.getUTCFullYear()+"-"+f+"-"+e}a.page&&(d.page=a.page);d.api=b;return d},q=function(a,d,b,c){var f=$.ajax({url:"https://api.themoviedb.org/3/find/"+a,type:"GET",data:{external_source:"imdb_id",api_key:"f2d9fc51f6de779fb245cb121166eb5a"},error:function(){null!==app.queries.get(d)&&c&&c()},success:function(c){null!==app.queries.get(d)&&(0===c.movie_results.length&&0===c.tv_results.length?console.error("Couldn't find movie/show in TheMovieDatabase with the IMDB code",
a):(0===c.movie_results.length&&b&&b(c.tv_results[0].id),0===c.tv_results.length&&b&&b(c.movie_results[0].id)))}});app.queries.addToQuery(d,f)};c.movie={metadata:{single:function(a){if(a.tmdbId){a.queryId=a.queryId||0;var d=$.ajax({url:"https://api.themoviedb.org/3/movie/"+a.tmdbId,type:"GET",data:{append_to_response:"credits,trailers,similar_movies",api_key:"f2d9fc51f6de779fb245cb121166eb5a"},error:function(){null!==app.queries.get(a.queryId)&&a.error&&a.error(arguments)},success:function(d){null!==
app.queries.get(a.queryId)&&a.success&&a.success(n(d))}});app.queries.addToQuery(a.queryId,d)}else a.imdbId||(console.error("Invalid API call: No ID provided"),a.success&&a.success([])),q(a.imdbId,a.queryId,function(d){a.tmdbId=d;c.movie.metadata.single(a)},a.error)},multiple:function(){}},torrent:{single:function(a){a.ytsId||(console.error("Invalid API call: No ID provided"),a.success&&a.success(!1));a.queryId=a.queryId||0;var d=e({url:"https://yts.re/api/v2/movie_details.json?movie_id="+a.ytsId,
error:function(){null!==app.queries.get(a.queryId)&&a.error&&a.error(arguments)},success:function(d){null!==app.queries.get(a.queryId)&&("error"===d.status?(console.error("https://yts.re/api/v2/: "+d.status_message),a.success&&a.success(!1)):(d=d.data,d={imdbId:d.imdb_code||a.imdbId,tmdbId:a.tmdbId,ytsId:d.id,torrent:_.map(d.torrents,m)},a.success&&a.success(d)))}});app.queries.addToQuery(a.queryId,d)},multiple:function(a){var d=h(a.data);a.queryId=a.queryId||0;d=e({url:"https://yts.re/api/v2/list_movies.json",
data:d,error:function(){null!==app.queries.get(a.queryId)&&a.error&&a.error(arguments)},success:function(d){if(null!==app.queries.get(a.queryId))if("error"===d.status)console.error("https://yts.re/api/v2/: "+d.status_message),a.success&&a.success([]);else if(d.data.hasOwnProperty("movies")){d=d.data.movies;_.isArray(d)||(d=[d]);var b=[];_.each(d,function(a){a.hasOwnProperty("imdb_code")&&b.push({imdbId:a.imdb_code,ytsId:a.id,torrent:_.map(a.torrents,m)})});a.success&&a.success(b)}else a.success&&
a.success([])}});app.queries.addToQuery(a.queryId,d)},similar:function(a){a.ytsId||(console.error("Invalid API call: No ID provided"),a.success&&a.success(!1));a.queryId=a.queryId||0;var d=e({url:"https://yts.re/api/v2/movie_suggestions.json?movie_id="+a.ytsId,error:function(){null!==app.queries.get(a.queryId)&&a.error&&a.error(arguments)},success:function(d){if(null!==app.queries.get(a.queryId))if("error"===d.status)console.error("https://yts.re/api/v2/: "+d.status_message),a.success&&a.success([]);
else{d=d.data.movie_suggestions;_.isArray(d)||(d=[d]);var b=[];_.each(d,function(a){b.push({imdbId:a.imdb_code,ytsId:a.id,torrent:_.map(a.torrents,m)})});a.success&&a.success(b)}}});app.queries.addToQuery(a.queryId,d)}}};c.tvShow={metadata:{single:function(a){if(a.tmdbId){var d=$.ajax({url:"https://api.themoviedb.org/3/tv/"+a.tmdbId,type:"GET",data:{append_to_response:"credits,external_ids,similar",api_key:"f2d9fc51f6de779fb245cb121166eb5a"},error:function(){null!==app.queries.get(a.queryId)&&a.error&&
a.error(arguments)},success:function(d){null!==app.queries.get(a.queryId)&&a.success&&a.success(l(d))}});app.queries.addToQuery(a.queryId||0,d)}else a.imdbId||(console.error("Invalid API call: No ID provided"),a.success&&a.success([])),q(a.imdbId,a.queryId,function(d){a.tmdbId=d;c.tvShow.metadata.single(a)},a.error)},season:function(a){if(a.tmdbId){var d=$.ajax({url:"https://api.themoviedb.org/3/tv/"+a.tmdbId+"/season/"+a.seasonNumber,type:"GET",data:{api_key:"f2d9fc51f6de779fb245cb121166eb5a"},error:function(){null!==
app.queries.get(a.queryId)&&a.error&&a.error(arguments)},success:function(d){null!==app.queries.get(a.queryId)&&(d=_.map(d.episodes,f),a.success&&a.success(d))}});app.queries.addToQuery(a.queryId||0,d)}else a.imdbId||(console.error("Invalid API call: No ID provided"),a.success&&a.success([])),q(a.imdbId,a.queryId,function(d){a.tmdbId=d;c.tvShow.metadata.season(a)},a.error)},multiple:function(a){var d=k(a.data),b=d.api;delete d.api;d=$.ajax({url:"https://api.themoviedb.org/3/"+b,type:"GET",data:d,
error:function(){null!==app.queries.get(a.queryId)&&a.error&&a.error(arguments)},success:function(d){null!==app.queries.get(a.queryId)&&(d=_.chain(d.results).reject(function(a){return!a.name}).reject(function(a){return!a.poster_path}).map(function(a){return{tmdbId:a.id}}).value(),a.success&&a.success(d))}});app.queries.addToQuery(a.queryId||0,d)}},torrent:{single:function(a){var d=(10>a.episode?"0":"")+a.episode,c=(10>a.season?"0":"")+a.season,f=a.title+" S"+c+"E"+d,e=function(b){b=$(b).find("a.imagnet");
for(var f=[],e=0;e<b.length;e++){var h;h=$(b.get(e));var p=$(h.parents("tr").get(0)).find("td");h={name:p.find(".torrentname .cellMainLink").text()||"",quality:"",seeds:$(p.get(-2)).html()||0,peers:$(p.get(-1)).html()||0,size:$(p.get(-5)).html()||"",url:h.attr("href")||""};0!=h.seeds&&(-1===h.name.indexOf("S"+c+"E"+d)&&-1===h.name.indexOf(a.season+"x"+a.episode)&&-1===h.name.indexOf(a.season+"x"+d)||f.push(h))}return f},h={url:"http://katph.eu/usearch/"+f+"/",error:function(){null!==app.queries.get(a.queryId)&&
a.error&&a.error()},success:function(c){null!==app.queries.get(a.queryId)&&(c=e(c),0===c.length?(f=a.title+" "+a.season+"x"+d,h.url="http://katph.eu/usearch/"+f+"/",h.success=function(d){null!==app.queries.get(a.queryId)&&(d=e(d),a.success&&a.success(d))},c=b(h),app.queries.addToQuery(a.queryId||0,c)):a.success&&a.success(c))}},k=b(h);app.queries.addToQuery(a.queryId||0,k)},season:function(){},multiple:function(){}}};c.all={search:function(a){var d=k(a);delete d.api;d=$.ajax({url:"https://api.themoviedb.org/3/search/multi",
type:"GET",data:d,error:function(){null!==app.queries.get(a.queryId)&&a.error&&a.error(arguments)},success:function(d){null!==app.queries.get(a.queryId)&&(d=_.chain(d.results).reject(function(a){return!a.title&&!a.name}).reject(function(a){return!a.first_air_date&&!a.release_date}).reject(function(a){return!a.poster_path}).map(function(a){return{tmdbId:a.id,title:a.title||a.name,type:a.media_type,year:(a.first_air_date||a.release_date).slice(0,4),posterImage:"http://image.tmdb.org/t/p/w300"+a.poster_path}}).value(),
a.success&&a.success(d))}});app.queries.addToQuery(a.queryId||0,d)}}})(window.app);
(function(c){var g={},b=["movie","tvShow"],e={movie:function(b){return{imdbId:b.imdbId,tmdbId:b.tmdbId,ytsId:b.ytsId}},tvShow:function(b){return{imdbId:b.imdbId,tmdbId:b.tmdbId}}},n=function(e,f){var h=c.lists.get(e);if("object"!==typeof h)return[];"undefined"===typeof h[f]&&b.indexOf(f)&&(h[f]=[]);return h[f]||[]},m=function(b,f,e){"object"===typeof c.lists.get(b)&&(g[b][f]=e)};c.lists={newList:function(e,f){f=f||{};g[e]={};_.each(b,function(b){g[e][b]=[];_.isArray(f[b])&&_.each(f[b],function(f){c.lists.addToList(e,
b,f)})});c.lists.save()},addToList:function(b,f,h){c.lists.removeFromList(b,f,h);"object"!==typeof c.lists.get(b)&&c.lists.newList(b);var k=n(b,f);h=(e[f]||_.identity)(h);h.time=_.now();k.push(h);g[b][f]=k;m(b,f,k);c.lists.save()},removeFromList:function(b,f,e){var k=c.lists.search(b,f,e);e=n(b,f);e=_.reject(e,function(b){return _.findWhere(k,b)});m(b,f,e);c.lists.save()},search:function(b,c,h){b=n(b,c);var k=(e[c]||_.identity)(h);return _.filter(b,function(b){return _.matches(k)(b)||_.matches(b)(k)})},
get:function(b){c.lists.load();return g[b]},save:function(){$.jStorage.set("lists",g)},load:function(){g=$.jStorage.get("lists",{})},renderList:function(b,e,h){var k=c.lists.get(b)||{};h=h||{};_.each(e,function(b,a){app.media[a].byId({container:b,failMessage:h[a],items:k[a]||[]})})}}})(window.app);
(function(c){c.media||(c.media={});c=c.media;var g=function(a,d,b){"undefined"!==typeof d&&1!==d||app.queries.cancel(a);d=app.queries.newQuery();app.queries.associateQuery(d,a);a.data("next-page",b);a.addClass("loading");$(a.data("loading-indicator")).fadeIn();return d},b=function(a){a=_.defaults(a||{},{container:$("#results")});a.filter=_.defaults(a.filter||{},{sort:"popularity",sortOrder:"desc",page:1});return a},e=function(a,d,b,c){a.removeClass("loading");$(a.data("loading-indicator")).fadeOut();
a.data("next-page","");1===b&&(d&&0<d.length?a.html("<div class='no-results'>No "+c+"s matching <span class='keywords'>"+d+"</span> were found.</div>"):a.html("<div class='no-results'>No "+c+" results found.</div>"))},n=function(a,d){a.removeClass("loading");$(a.data("loading-indicator")).fadeOut();a.html("<div class='no-results'>"+d+"</div>")},m=function(a,d,b){0>d?setTimeout(function(){a(d+1)},3E3):b()},l=function(a){a=Math.round(a)/2;for(var d="",b=1;b<=Math.floor(a);b++)d+="<i class='icon-star'></i>";
0<a%1&&(d+="<i class='icon-star-half-empty'></i>");for(b=Math.ceil(a);5>b;b++)d+="<i class='icon-star-o'></i>";return d},f=function(a,d,b){var e=a.metadata,f=0<app.lists.search("bookmarks",d,a).length,h=$("<div data-imdb-id='"+e.imdbId+"' class='media-result navigable-item'></div>");h.append($("<div class='result-container'></div>").append("<div class='result-poster-container'><img src='"+e.posterImage+"'></div>").append($("<div class='clearfix result-info' title='"+e.title+"'></div>").append("<div class='result-title'>"+
e.title+"</div>").append("<a class='result-bookmark"+(f?" bookmarked":"")+"'><i class='icon-heart'></i></a>").append("<div class='result-year'>"+e.year+"</div>").append("<div class='result-rating simptip-position-top simptip-fade simptip-smooth' data-tooltip='"+e.rating+"'>"+l(e.rating)+"</div>")));h.on("click",function(){c[d].openDetails(a)});h.on("mousemove",function(){app.nav.paused()||app.nav.selectElement(h)}).on("mouseout",function(){app.nav.paused()||app.nav.deselect()}).find(".result-bookmark").on("click",
function(b){b.preventDefault();b.stopPropagation();f?(app.lists.removeFromList("bookmarks",d,a),$(this).removeClass("bookmarked")):(app.lists.addToList("bookmarks",d,a),$(this).addClass("bookmarked"));return!1});e.rating||h.find(".result-rating").hide();b.append(h.hide());h.find("img").on("load",function(){h.detach();b.append(h.fadeIn().css("display",""))})},h=function(a,d){var b=d.metadata;a.find(".media-details-poster").find("img").attr("src","").attr("src",b.posterImage);a.find(".media-details-backdrop").find("img").attr("src",
"").attr("src",b.backdropImage);a.find(".media-details-title").html(b.title+" <span>("+b.year+")</span>");a.find(".media-details-desc").html(b.description);a.find(".media-details-actors").html(b.cast.join(", "));a.find(".media-details-runtime").html(b.runtime);b.rating?a.find(".media-details-rating").attr("data-tooltip",b.rating).html(l(b.rating)).show():a.find(".media-details-rating").attr("data-tooltip","").html("").hide();a.is(":visible")&&a.hide();a.find(".media-details-foreground").hide();a.animate({width:"show"}).find(".media-details-foreground").fadeIn(400,
app.nav.deselect);a.data("previous-view")||a.data("previous-view",app.nav.currentView())},k=c.movie={},q=c.tvShow={};k.list=function(a){a=b(a);var d=g(a.container,a.filter.page,function(){a.filter.page++;k.list(a)});1===a.filter.page&&a.container.empty();var c=_.partial(e,a.container,a.filter.keywords,a.filter.page,"movie");(function s(b){var e=_.partial(m,s,b,function(){c();var d=$("<a style='padding-right: 20px' title='Try again'><i class='icon-repeat'></i></a>").on("click",function(){k.list(a)});
a.container.find(".no-results").empty().append(d).append("Error getting movies...")});app.api.movie.torrent.multiple({data:a.filter,queryId:d,success:function(b){if(null!==app.queries.get(d)){0===_.size(b)&&c();var h=0;_.each(b,function(k){app.api.movie.metadata.single(_.extend({},k,{queryId:d,success:function(e){if(null!==app.queries.get(d))if(a.filter.genre&&-1===e.genres.indexOf(a.filter.genre))++h===_.size(b)&&c();else{a.container.removeClass("loading");$(a.container.data("loading-indicator")).fadeOut();
k.metadata=e;k.tmdbId=e.tmdbId;k.imdbId=e.imdbId;try{f(k,"movie",a.container)}catch(p){++h===_.size(b)&&c()}}},error:e}))})}},error:e})})(1)};q.list=function(a){a=b(a);var d=g(a.container,a.filter.page,function(){a.filter.page++;q.list(a)});1===a.filter.page&&a.container.empty();var c=_.partial(e,a.container,a.filter.keywords,a.filter.page,"TV show");(function s(b){var e=_.partial(m,s,b,function(){c();var d=$("<a style='padding-right: 20px' title='Try again'><i class='icon-repeat'></i></a>").on("click",
function(){k.list(a)});a.container.find(".no-results").empty().append(d).append("Error getting movies...")});app.api.tvShow.metadata.multiple({data:a.filter,queryId:d,success:function(b){if(null!==app.queries.get(d)){0===_.size(b)&&c();var h=0;_.each(b,function(k){app.api.tvShow.metadata.single(_.extend({},k,{queryId:d,success:function(e){if(null!==app.queries.get(d))if(a.filter.genre&&-1===e.genres.indexOf(a.filter.genre))++h===_.size(b)&&c();else{a.container.removeClass("loading");$(a.container.data("loading-indicator")).fadeOut();
k.metadata=e;k.imdbId=e.imdbId;try{f(k,"tvShow",a.container)}catch(p){++h===_.size(b)&&c()}}},error:e}))})}},error:e})})(1)};k.byId=function(a){a=_.defaults(a||{},{container:$("#results"),render:f});var d=g(a.container),b=_.partial(n,a.container,a.failMessage||"There aren't any movies in this list yet.");(function s(c){var e=_.partial(m,s,c,function(){b();var d=$("<a style='padding-right: 20px' title='Try again'><i class='icon-repeat'></i></a>").on("click",function(){k.list(a)});a.container.find(".no-results").empty().append(d).append("Error getting movies...")});
0===_.size(a.items)&&b();var f=0;_.each(a.items,function(c){app.api.movie.torrent.single(_.extend({},c,{queryId:d,success:function(c){null!==app.queries.get(d)&&(!1===c?++f===_.size(a.items)&&b():app.api.movie.metadata.single(_.extend({},c,{queryId:d,success:function(e){if(null!==app.queries.get(d)){a.container.removeClass("loading");$(a.container.data("loading-indicator")).fadeOut();c.metadata=e;c.tmdbId=e.tmdbId;c.imdbId=e.imdbId;try{a.render(c,"movie",a.container)}catch(p){++f===_.size(a.items)&&
b()}}},error:e})))},error:e}))})})(1)};q.byId=function(a){a=_.defaults(a||{},{container:$("#results"),render:f});var d=g(a.container),b=_.partial(n,a.container,a.failMessage||"There aren't any TV shows in this list yet.");(function s(c){var e=_.partial(m,s,c,function(){b();var d=$("<a style='padding-right: 20px' title='Try again'><i class='icon-repeat'></i></a>").on("click",function(){k.list(a)});a.container.find(".no-results").empty().append(d).append("Error getting TV shows...")});0===_.size(a.items)&&
b();var f=0;_.each(a.items,function(c){app.api.tvShow.metadata.single(_.extend({},c,{queryId:d,success:function(e){if(null!==app.queries.get(d))if(!1===c)++f===_.size(a.items)&&b();else{a.container.removeClass("loading");$(a.container.data("loading-indicator")).fadeOut();c.metadata=e;c.tmdbId=e.tmdbId;c.imdbId=e.imdbId;try{a.render(c,"tvShow",a.container)}catch(h){++f===_.size(a.items)&&b()}}},error:e}))})})(1)};k.openDetails=function(a){var b=$("#movie-details"),e=a.metadata,f=a.torrent;h(b,a);if(e.trailer)$("#movie-details-trailer").show().unbind("click").on("click",
function(){$("#youtube-player").attr("src","http://www.youtube.com/embed/"+e.trailer+"?autoplay=1&origin=http://webflix.me");$("#youtube-modal").data("onClose",function(){$("#youtube-player").attr("src",null)});fn.openModal("#youtube-modal")});else $("#movie-details-trailer").hide().unbind("click");var n=$("#movie-details-similar").html("Loading similar movies...");app.api.movie.torrent.similar({ytsId:a.ytsId,success:function(a){a=_.shuffle(a).slice(0,3);k.byId({container:n,items:a,failMessage:"Couldn't load similar movies...",
render:function(a,b,d){var e=$("<a>"+a.metadata.title+"</a>").hide();e.on("click",function(){c[b].openDetails(a)});"Loading similar movies..."===d.html()?d.html("People also watched: ").append(e.fadeIn().css("display","")).fadeIn():d.append(", ").append(e.fadeIn().css("display",""))}})},error:function(){n.html("<div class='no-results'>Couldn't load similar movies...</div>")}});var g=_.indexBy(f,"quality");g.hasOwnProperty("1080p")&&g.hasOwnProperty("720p")?$("#movie-details-quality").show():$("#movie-details-quality").hide();
if(0===f.length)$("#movie-details-watch").hide();else $("#movie-details-watch").show().unbind("click").on("click",function(){var b;b=$("#movie-details-quality");b=b.is(":hidden")?f[0]:b.find("input[type=checkbox]").is(":checked")?g["1080p"]:g["720p"];a.mediaType="movie";app.torrents.play(b.url,a)});app.nav.switchView("movie-details")};q.openDetails=function(a){var b=$("#tv-details"),e=a.metadata;h(b,a);b=$("#tv-details-similar").html("Loading similar shows...");0<e.similar.length?q.byId({container:b,
items:e.similar.slice(0,3),failMessage:"Couldn't load similar shows...",render:function(a,b,d){var e=$("<a>"+a.metadata.title+"</a>").hide();e.on("click",function(){c[b].openDetails(a)});"Loading similar shows..."===d.html()?d.html("People also watched: ").append(e.fadeIn().css("display","")).fadeIn():d.append(", ").append(e.fadeIn().css("display",""))}}):b.empty().hide();$("#tv-details-seasons, #tv-details-episodes").empty();$("#tv-details-episode-title, #tv-details-episode-desc, #tv-details-episode-air-date").html("");
$("#tv-details-episode-still").find("img").attr("src","");$("#tv-details-episode-title, #tv-details-episode").hide();var f=$("<li class='tv-details-season navigable-item'></li>"),k=$("#tv-details-seasons").empty();_.each(e.seasons,function(b){0!==b.number&&"number"===typeof b.number&&k.append(f.clone().data("season-number",b.number).html("Season "+b.number).on("mousemove",function(){app.nav.paused()||app.nav.selectElement($(this))}).on("mouseout",function(){app.nav.paused()||app.nav.deselect()}).on("click",
function(){q.openSeason(a,b)}))});k.scrollTo(0).find(".tv-details-season").first().click();app.nav.switchView("tv-details")};q.openSeason=function(a,b){var c=$("#tv-details-episodes");$(".tv-details-season").removeClass("active").filter(function(){return $(this).data("season-number")===b.number}).addClass("active");var e=g(c);c.empty();c.slideUp(300,function(){app.api.tvShow.metadata.season({tmdbId:a.tmdbId,imdbId:a.imdbId,queryId:e,seasonNumber:b.number,success:function(f){if(null!==app.queries.get(e)){c.empty();
var h=$("<li class='tv-details-episode navigable-item'></li>");_.each(f,function(e){c.append(h.clone().data("episode-number",e.number).attr("title",e.title).html(e.number+". "+e.title).on("mousemove",function(){app.nav.paused()||app.nav.selectElement($(this))}).on("mouseout",function(){app.nav.paused()||app.nav.deselect()}).on("click",function(){q.openEpisode(a,b,e)}))});c.removeClass("loading");$(c.data("loading-indicator")).fadeOut();c.slideDown(300,function(){c.scrollTo(0).parent()});c.hasClass("used-keyboard")&&
(app.nav.selectElement($(".tv-details-episode").first()),c.scrollTo(".selected").removeClass("used-keyboard"))}},error:function(){c.removeClass("loading");$(c.data("loading-indicator")).fadeOut()}})})};q.openEpisode=function(a,b,c){var e=$("#tv-details-episode-container"),f=$("#tv-show-torrent-links");$(".tv-details-episode").removeClass("active").filter(function(){return $(this).data("episode-number")===c.number}).addClass("active");c.stillImage?$("#tv-details-episode-still").find("img").attr("src",
"").attr("src",c.stillImage).parent().show():$("#tv-details-episode-still").find("img").attr("src","").parent().hide();$("#tv-details-episode-title").html(c.title).attr("title",c.title);$("#tv-details-episode-air-date").html("Air date: "+c.airDate);$("#tv-details-episode-desc").html(c.description||a.description);$("#tv-details-episode-title, #tv-details-episode").fadeIn();var h=g(e);e.removeClass("no-links").addClass("loading").fadeIn();f.empty();app.api.tvShow.torrent.single({title:a.metadata.title,
season:b.number,episode:c.number,queryId:h,success:function(k){if(null!==app.queries.get(h)){var n=$("#tv-show-torrent-link-template").clone().attr("id","");_.each(k,function(e,h){var p=n.clone();p.find(".link-name").html("Link "+(h+1));p.find(".link-detailed").attr("title",e.name.replace(/['"]/g,"")).html("<strong>"+e.size+"</strong> &middot; "+e.name);p.find(".link-info-detailed").html(e.seeds+(1==e.seeds?" seed":" seeds")+" &middot; "+e.peers+(1==e.peers?" peer":" peers"));10>e.seeds?p.find(".link-info").addClass("low"):
100>e.seeds?p.find(".link-info").addClass("med"):p.find(".link-info").addClass("high");p.on("mousemove",function(){app.nav.paused()||app.nav.selectElement($(this))}).on("mouseout",function(){app.nav.paused()||app.nav.deselect()}).on("click",function(){$("#modal-bg").click();a.mediaType="tvShow";app.torrents.play(e.url,a);if($("#autoplay-next-episode").is(":checked")){var f=c.number+1,p=b.number;f>b.episodeCount&&(f=1,p=b.number+1);p<a.metadata.seasons.length&&f<a.metadata.seasons[p].episodeCount&&
app.api.tvShow.torrent.single({title:a.metadata.title,season:p,episode:f,queryId:0,success:function r(b){$("#player").is(":visible")?app.torrents.play(b[0].url,a):setTimeout(function(){r(b)},1E3)}})}});f.append(p);3>=f.children().length&&p.show()});e.removeClass("loading");if(0===f.children().length)e.addClass("no-links");else if(3<f.children().length){$("#tv-details-episode-torrents-more").remove();var g=$("<div class='link navigable-item' id='tv-details-episode-torrents-more' style='text-align: center'>View more<div class='link-detailed'><i class='icon-chevron-down'></i></div></div>");
g.on("mousemove",function(){app.nav.paused()||app.nav.selectElement($(this))}).on("mouseout",function(){app.nav.paused()||app.nav.deselect()}).on("click",function(){var a=f.children();$(a.filter(":hidden").slice(0,3)).slideDown(100,"swing",function(){0===a.filter(":hidden").length&&g.slideUp()})});f.append(g)}}},error:function(){e.removeClass("loading");e.addClass("no-links")}})}})(window.app);
(function(c){c.nav||(c.nav={});c=c.nav;var g={};c.View=function(b,c,e){this.name=b;this.panes=c;this.defaultPane="undefined"!==typeof e?e:1;g[b]=this};var b="results",e=1;c.currentView=function(){return b};c.switchView=function(c){"undefined"===typeof c&&(c=b);g[c]&&(b=c,e=g[c].defaultPane)};var n=function(b){var c=b.find(".navigable-item:visible").not(".active");if(0===c.length)return 0;b.hide();var e=c.css("width");b.show();var n=_.reduce(c,function(a,b){return a+$(b).outerWidth()},0)/c.length,
a=parseFloat(c.css("min-width"))||0,c=parseFloat(c.css("max-width"))||Infinity;return-1!==e.indexOf("%")&&n>a&&n<c?Math.floor(100/+e.split("%")[0]):Math.floor(b[0].clientWidth/n)},m=function(f,h){if(!c.paused()){var k=g[b],l=k.panes[e],a=n(l),l=l.find(".navigable-item:visible").not(".active"),d=l.filter(".selected"),d=l.index(d);-1===d&&(d=-f-h*a);0===h&&0<f&&d===l.length-1&&e<k.panes.length-1||0===h&&0<f&&d%a===a-1&&e<k.panes.length-1||0===h&&0>f&&0===d%a&&0<e?k.panes[e+f].is(":hidden")||(e+=f,l.removeClass("selected"),
m(0,0)):(c.pause(),d+f+h*a>=l.length||0>d+f+h*a?c.unpause():(c.select(e,d+f+h*a),d=$(l.get(d+f+h*a)),d.parent().scrollTo(d,{axis:"y",duration:100,onAfter:function(){c.unpause()}})))}};c.right=function(){m(1,0)};c.left=function(){m(-1,0)};c.up=function(){m(0,-1)};c.down=function(){m(0,1)};c.select=function(f,h){var k=$(g[b].panes[f].find(".navigable-item:visible").not(".active").get(h));c.deselect();k.addClass("selected");e=f};c.selectElement=function(b){if(!b.hasClass("active")){var e=b.parents(".navigable-pane");
b=e.find(".navigable-item:visible").not(".active").index(b);e=e.data("pane-number");c.select(e,b)}};c.deselect=function(){$(".navigable-item.selected").removeClass("selected")};var l=!1;c.pause=function(){l=!0};c.unpause=function(){setTimeout(function(){l=!1},100)};c.paused=function(){return l}})(window.app);
(function(c){var g=[[]];c.queries={associateQuery:function(b,c){"undefined"===typeof c.data("query-ids")&&c.data("query-ids",[]);c.data("query-ids").push(b)},newQuery:function(b){_.isArray(b)||(b=[]);var c=g.length;g[c]=b;return c},addToQuery:function(b,c){_.isNull(g[b])?c.abort():(_.isArray(g[b])||(g[b]=[]),g[b].push(c))},get:function(b){return g[b]},cancel:function(b){b instanceof jQuery&&b.data("query-ids")?(_.each(b.data("query-ids"),function(b){app.queries.cancel(b)}),b.data("query-ids",[])):
_.isArray(g[b])&&(_.each(g[b],function(b){b.abort()}),g[b]=null)}}})(window.app);
(function(c){c.setup||(c.setup={});c=c.setup;var g=function(b){$(".results-page").each(function(){$($(this).data("loading-indicator")).fadeOut();_.each($(this).data("query-ids"),function(b){app.queries.cancel(b)})}).empty();$(".main").hide();fn.closeDetails();"sidebar-downloads"!==b.attr("id")&&clearInterval($("#downloads").fadeOut().data("update-interval"));$("#search-overlay").is(":visible")&&$("#search-overlay-bg").click();$("#sidebar").find("a").removeClass("active");b.addClass("active")};c.errorTracking=
function(){if("undefined"!==typeof ga){var b=function(b,c,g,l,f){"undefined"!==typeof g&&(c+=" ("+g,"undefined"!==typeof l&&(c+=":"+l,"undefined"!==typeof f&&(c+=","+f)),c+=")");ga("send","event","error",b,c)};window.onerror=function(c,g,m,l){g&&(g=g.split("/"),g=g[g.length-1]);b("js error",c,g,m,l)};$(document).ajaxError(function(c,g,m){b("ajax error",c.result||g.statusText,m.url)})}};c.keyboardShortcuts=function(){Mousetrap.reset();$("#keyboard-shortcuts").is(":checked")&&(Mousetrap.bind("?",function(){fn.openModal("#info-modal")}),
Mousetrap.bind("q",function(){$("#sidebar-search").click()}),Mousetrap.bind("f",function(){$("#videojs-container").is(":visible")&&(app.player.videojs.isFullscreen()?app.player.videojs.exitFullscreen():app.player.videojs.requestFullscreen());$("#projekktor-container").is(":visible")&&(app.player.projekktor.getInFullscreen()?app.player.projekktor.setFullscreen(!1):app.player.projekktor.setFullscreen(!0))}),Mousetrap.bind(["esc","backspace"],function(b){b&&b.preventDefault&&b.preventDefault();b=$("#modal-bg");
if(b.is(":visible"))return b.click(),!1;$(".media-details").is(":visible")&&fn.closeDetails();return!1}),Mousetrap.bind(["space","p"],function(){$("#videojs-container").is(":visible")&&(app.player.videojs.paused()?app.player.videojs.play():app.player.videojs.pause());$("#projekktor-container").is(":visible")&&app.player.projekktor.setPlayPause()}),Mousetrap.bind("up",function(b){b&&b.preventDefault&&b.preventDefault();if($("#videojs-container").is(":visible"))return app.player.videojs.volume(Math.min(app.player.videojs.volume()+
0.05,1)),!1;if($("#projekktor-container").is(":visible"))return app.player.projekktor.setVolume(Math.min(app.player.projekktor.getVolume()+0.05,1)),!1;app.nav.up();return!1}),Mousetrap.bind("down",function(b){b&&b.preventDefault&&b.preventDefault();if($("#videojs-container").is(":visible"))return app.player.videojs.volume(Math.max(app.player.videojs.volume()-0.05,0)),!1;if($("#projekktor-container").is(":visible"))return app.player.projekktor.setVolume(Math.max(app.player.projekktor.getVolume()-0.05,
0.05)),!1;app.nav.down();return!1}),Mousetrap.bind("left",function(b){b&&b.preventDefault&&b.preventDefault();if($("#videojs-container").is(":visible"))return app.player.videojs.currentTime(app.player.videojs.currentTime()-10),!1;app.nav.left();return!1}),Mousetrap.bind("right",function(b){b&&b.preventDefault&&b.preventDefault();if($("#videojs-container").is(":visible"))return app.player.videojs.currentTime(app.player.videojs.currentTime()+10),!1;app.nav.right();return!1}),Mousetrap.bind("enter",
function(){$(".navigable-item.selected:not(.active):visible").click().removeClass("selected")}),$("#sidebar, #movie-details").on("mouseover",function(){$(this).find(".selected").removeClass("selected")}))};c.loadNewPage=function(){$(".results-page").scroll(function(){var b=$(this);b.hasClass("loading")||b.scrollTop()+b.height()<b[0].scrollHeight-500||"function"===typeof b.data("next-page")&&b.data("next-page")()})};c.modals=function(){$("#modal-bg").on("click",function(){$(".modal, #modal-bg, #status").fadeOut();
var b=$($(this).attr("data-modal"));$(this).attr("data-modal","");$(this).data("previous-view")&&app.nav.switchView($(this).data("previous-view"));$(this).data("previous-view",null);b.fadeOut();b.data("on-close")&&b.data("on-close")(b);"tos-modal"!==b.attr("id")||app.connected||setTimeout(function(){fn.openModal("#setup-modal")},500)})};c.search=function(){var b=function(){var b=$("#search-overlay");$("#search-overlay-container").animate({width:0});b.fadeOut(400,function(){$("#search-overlay-keywords").val("");
$("#search-overlay-results").html("")});app.nav.switchView(b.data("previous-view"))};$("#search-overlay-bg").on("click",b);$("#search-overlay-form").on("submit",function(b){b&&b.preventDefault&&b.preventDefault();g($("#sidebar-search"));app.nav.switchView("search");$("#search-genre, #search-sort").attr("selectedIndex",0);$("#search-results").fadeIn();b=$("#search-overlay-keywords");$("#keywords").val(b.val());$("#search-bar").submit();b.val("");return!1});$("#search-overlay-keywords").on("keyup",
_.debounce(function(b){if(40!==b.keyCode&&38!==b.keyCode){var c=$(this).val(),g=$("#search-overlay-results");if(""===c)g.html("");else if(g.data("search-keywords")!==c){var l=$("#search-overlay-result").clone().attr("id","");app.api.all.search({keywords:c,queryId:0,success:function(b){g.empty().data("search-keywords",c);_.each(b,function(b){var c=l.clone();c.find(".search-overlay-result-poster").find("img").hide().attr("src",b.posterImage).on("load",function(){$(this).fadeIn()});c.find(".search-overlay-result-title").html(b.title);
c.find(".search-overlay-result-year").html(b.year);c.attr("title",b.title);c.on("mousemove",function(){app.nav.paused()||app.nav.selectElement($(this))}).on("mouseout",function(){app.nav.paused()||app.nav.deselect()});g.append(c.show())})}})}}},200)).on("keydown",function(c){if(27===c.keyCode)b();else if(40===c.keyCode||38===c.keyCode){var g=$("#search-overlay-results").find(".search-overlay-result");0!==g.length&&(0===g.filter(".selected").length?app.nav.selectElement($(g.get(0))):(40===c.keyCode&&
app.nav.down(),38===c.keyCode&&app.nav.up()),c=g.filter(".selected"),$("#search-overlay-keywords").val(c.find(".search-overlay-result-title").html()))}});$("#search-bar").on("submit",function(b){b&&b.preventDefault&&b.preventDefault();b={};var c=$("#keywords").blur().val();"string"===typeof c&&(b.keywords=c);var c=$("#search-sort").find(":selected"),g=c.data("sort");"string"===typeof g&&(b.sort=g);c=c.data("sort-order");"string"===typeof c&&(b.sortOrder=c);c=$("#search-genre").find(":selected");g=
c.data("movie-genre");"string"===typeof g&&(b.genre=g);app.media.movie.list({container:$("#movie-search-results"),filter:b});delete b.genre;g=c.data("tv-genre");"string"===typeof g&&(b.genre=g);app.media.tvShow.list({container:$("#tv-search-results"),filter:b});return!1});$("#search-genre").on("change",function(){$("#search-bar").submit()});$("#search-sort").on("change",function(){$("#search-bar").submit()})};c.settings=function(){for(var b=$("[data-storage-id]"),c={"settings-max-download-speed":function(b){b=
parseInt(b,10);isNaN(b)||0>b?$("#max-download-speed").val("0").trigger("change"):app.btapp.live("settings",function(c){c&&c.save({max_dl_rate:b})})},"settings-max-upload-speed":function(b){b=parseInt(b,10);isNaN(b)||0>b?$("#max-upload-speed").val("0").trigger("change"):app.btapp.live("settings",function(c){c&&c.save({max_ul_rate:b})})},"settings-keyboard-shortcuts":function(b){fn.setup.keyboardShortcuts()}},g=function(){for(var f=0;f<b.length;f++){var g=$(b.get(f)),k="checkbox"===g.attr("type")?g.is(":checked"):
g.val();$.jStorage.set(g.attr("data-storage-id"),k);if(c.hasOwnProperty(g.attr("data-storage-id")))c[g.attr("data-storage-id")](k)}},m=0;m<b.length;m++){var l=$(b.get(m));"checkbox"===l.attr("type")&&(l.val=function(b){var c=$(this);if("undefined"===typeof b)return c.is(":checked");c.attr("checked",b);return c});if(null!==$.jStorage.get(l.attr("data-storage-id")))l.val($.jStorage.get(l.attr("data-storage-id"))).on("change",g);else $.jStorage.set(l.attr("data-storage-id"),l.val())}$("#settings").submit(function(c){c.preventDefault();
for(c=0;c<b.length;c++)$(b.get(c)).trigger("change");return!1});$("#settings-reset").on("click",function(){if(confirm("Warning: Are you sure you want to reset all settings?")){for(var c=0;c<b.length;c++){var e=$(b.get(c));null!==$.jStorage.get(e.attr("data-storage-id"))&&$.jStorage.deleteKey(e.attr("data-storage-id"))}window.location.reload()}});$("#default-download-directory").on("focus",function(){app.btapp.browseforfolder&&app.btapp.browseforfolder(function(b){"string"===typeof b&&$("#default-download-directory").val(b).trigger("change")})})};
c.sidebar=function(){$("#sidebar").find("a").not(".sidebar-foot-link").not("#sidebar-search").on("click",function(b){b&&b.preventDefault&&b.preventDefault();g($(this));return!1});$("#sidebar-bookmarks").on("click",function(){app.nav.switchView("bookmarks");$("#bookmarks").fadeIn();app.lists.renderList("bookmarks",{movie:$("#movie-bookmarks-results"),tvShow:$("#tv-bookmarks-results")},{movie:"You haven't added any movies to your bookmarks yet.",tvShow:"You haven't added any TV shows to your bookmarks yet."})});
$("#sidebar-history").on("click",function(){app.nav.switchView("history");$("#history").fadeIn();app.lists.renderList("history",{movie:$("#movie-history-results"),tvShow:$("#tv-history-results")},{movie:"You haven't watched any movies yet.",tvShow:"You haven't watched any TV shows yet."})});$("#sidebar-search").on("click",function(){$("#search-results").is(":visible")?$("#keywords").focus():($("#search-overlay-container").animate({width:"400px"}),$("#search-overlay").data("previous-view",app.nav.currentView()).fadeIn(400,
function(){$("#search-overlay-keywords").val("").focus()}),app.nav.switchView("search-overlay"))});$("#sidebar-movies").on("click",function(){app.nav.switchView("results");$("#results").fadeIn();app.media.movie.list()});$("#sidebar-tv-shows").on("click",function(){app.nav.switchView("results");$("#results").fadeIn();app.media.tvShow.list()});$("#sidebar-downloads").on("click",function(){app.nav.switchView("downloads");app.torrents.renderList($("#torrent-list"));$("#downloads").fadeIn().data("update-interval",
setInterval(function(){app.torrents.renderList($("#torrent-list"))},1E3))});$("#open-settings").on("click",function(){fn.openModal("#settings-modal")});$("#open-info").on("click",function(){fn.openModal("#info-modal")});$("#open-keyboard-shortcuts").on("click",function(){fn.openModal("#keyboard-shortcuts-modal")});$("#sidebar-donate").click(function(b){b&&b.preventDefault&&b.preventDefault();b&&b.stopPropagation&&b.stopPropagation();$("#sidebar-donate-popover").fadeIn();$("body").add("#sidebar-donate-popover-close").click(function n(b){$("#sidebar-donate-popover").fadeOut();
$("body").unbind("click",n)});return!1});$("#sidebar-donate-popover").click(function(b){b&&b.stopPropagation&&b.stopPropagation()})};c.torqueConnectBtn=function(){$("#setup-torque").on("click",function(){fn.connectToTorque()});$(document).bind("close.facebox",function(){$("#facebox, #facebox_overlay").hide()})};c.torqueMessageReciever=function(){var b={"plugin:plugin_installed":"plugin installed","plugin:plugin_running":"plugin running","plugin:client_installed":"client installed","plugin:client_running":"client running",
"client:connected":"client connecting","client:disconnected":"client disconnected",sync:"client connected","client:error":"error","input:creating_torrent":"creating torrent","input:torrent_created":"torrent created","input:redirecting":"redirecting","input:waiting_for_folder_selection":"waiting for selection","input:no_files_selected":"no files selected"};app.btapp.on("all",function(c){b.hasOwnProperty(c)&&(app.status=b[c],"client installed"===app.status&&(app.installed=!0),"client connected"===app.status&&
(app.connected=!0),"client disconnected"===app.status&&(app.connected=!1),"sync"!==c&&console.log(c))})};c.userTorrent=function(){$("#add-torrent-start").on("click",function(){$("#add-torrent-form").submit()});$("#add-torrent-form").on("submit",function(b){b.preventDefault();b=$("#add-torrent-link").val();""!==b&&app.torrents.play(b);return!1})};c.views=function(){var b=$("#sidebar");new app.nav.View("bookmarks",[b,$("#movie-bookmarks-results"),$("#tv-bookmarks-results")]);new app.nav.View("history",
[b,$("#movie-history-results"),$("#tv-history-results")]);new app.nav.View("search-overlay",[b,$("#search-overlay-results")]);new app.nav.View("search",[b,$("#movie-search-results"),$("#tv-search-results")]);new app.nav.View("results",[b,$("#results")]);new app.nav.View("downloads",[b],0);new app.nav.View("movie-details",[b,$("#movie-details")]);new app.nav.View("tv-details",[b,$("#tv-details-seasons"),$("#tv-details-episodes"),$("#tv-details-episode")]);new app.nav.View("tv-torrents",[$("#tv-show-torrent-links")],
0);new app.nav.View("file-list",[$("#file-select-list")],0);$(".navigable-item").on("mousemove",function(){app.nav.paused()||app.nav.selectElement($(this))}).on("mouseout",function(){app.nav.paused()||app.nav.deselect()})};c.window=function(){$(window).on("beforeunload",function(){fn.stopDownloads()}).on("resize",function(){var b=$("#results");b.outerWidth()/b.outerHeight()>1280/720?$("#movie-details-backdrop, #tv-details-backdrop").find("img").width("100%").height("auto"):$("#movie-details-backdrop, #tv-details-backdrop").find("img").height("100%").width("auto")}).resize()}})(window.fn);
$(document).ready(function(){fn.setup.settings();fn.setup.errorTracking();fn.setup.keyboardShortcuts();fn.setup.loadNewPage();fn.setup.modals();fn.setup.search();fn.setup.sidebar();fn.setup.torqueConnectBtn();fn.setup.userTorrent();fn.setup.views();fn.setup.window();$("#sidebar-movies").click();app.player.projekktor=projekktor("#projekktor-player");app.player.videojs=videojs("videojs-player");1==$("#first-run").val()?$("#setup-modal, #modal-bg").fadeIn():fn.connectToTorque()});
(function(c){c.torrents||(c.torrents={});c=c.torrents;var g={},b=["avi","mp4","mkv"],e=function(a){this.hash=a.hash;this.url=a.url;this._btapp=a._btapp||app.btapp.get("torrent").get(this.hash);var c=this._btapp.get("properties");this.name=c.get("name");this.size=c.get("size");this.progress=0<this.size?Math.round(1E3*c.get("downloaded")/this.size)/10:0;this.downloadSpeed=c.get("download_speed");this.metadataResolved=c.get("metadata_resolved");if(a.files)this.files=a.files;else{var d=this.files=[];
this._btapp.get("file").each(function(a){var c=a.get("properties"),e=c.get("name"),e=e.substr(e.lastIndexOf(".")+1).toLowerCase();c.get("is_streamable")&&-1!==b.indexOf(e)?d.push(new n({name:c.get("name"),size:c.get("size"),downloaded:c.get("downloaded"),streaming_url:c.get("streaming_url"),torrent:a.get("torrent"),_btapp:a})):c.save({priority:Btapp.TORRENT.FILE.PRIORITY.NO_DOWNLOAD})})}},n=function(a){this.name=a.name;this.size=a.size;this.downloaded=a.downloaded;this.streaming_url=a.streaming_url;
this.torrent=a.torrent;this._btapp=a._btapp},m=function(a){return null!==a.match(/magnet:\?xt=urn:[a-z0-9]+:[a-z0-9]{32,40}/i)},l=function(a){return null!==a.match(/^[a-z0-9]{32,40}$/i)},f=function(a){var b={};a=a.split("magnet:?")[1];if(!a||0===a.length)return b;a.split("&").forEach(function(a){var c=a.split("=");2===c.length&&(a=c[0],c=c[1],"dn"===a&&(c=decodeURIComponent(c).replace(/\+/g," ")),"tr"===a&&(c=decodeURIComponent(c)),"kt"===a&&(c=decodeURIComponent(c).split("+")),b[a]?Array.isArray(b[a])?
b[a].push(c):b[a]=[b[a],c]:b[a]=c)});var c;b.xt&&(c=b.xt.match(/^urn:btih:(.{40})/))?b.infoHash=c[1]:b.xt&&(c=b.xt.match(/^urn:btih:(.{32})/))&&(b.infoHash=c[1]);b.dn&&(b.name=b.dn);b.kt&&(b.keywords=b.kt);"string"===typeof b.tr?b.announce=[b.tr]:Array.isArray(b.tr)&&(b.announce=b.tr);return b},h=c.add=function(a,b){app.connected?(console.log("torrents: adding: ",a),l(a)&&(a="magnet:?xt=urn:btih:"+a),app.btapp.get("add").torrent({url:a,location:$("#default-download-directory").val(),callback:function(c){app.btapp.live("torrent * properties",
function r(c,d){app.btapp.unbind("torrent * properties",r);if(m(a)){if(c.get("hash").toLowerCase()!==f(a).infoHash.toLowerCase())return}else if(c.get("uri").toLowerCase()!==a.toLowerCase()&&c.get("download_url").toLowerCase()!==a.toLowerCase())return;var h=c.get("hash");console.log("torrents: added: ",h);g[h]=new e({hash:h,url:a,_btapp:d});b&&b(h)})}})):fn.connectToTorque()},k=c.get=function(a){return"*"===a?g:g[a]},q=c.start=function(a){var b=k(a)._btapp;b.start();b.unpause();b.set_priority(Btapp.TORRENT.PRIORITY.MEDIUM);
_.each(k(a).files,function(a){a._btapp.get("properties").save({priority:Btapp.TORRENT.FILE.PRIORITY.MEDIUM})});b.get("properties").unbind("change",t).on("change",t)},a=c.stop=function(a){a=k(a)._btapp;a.stop();a.get("properties").unbind("change",t)},d=c.remove=function(a){k(a)._btapp.remove(Btapp.REMOVE.DELETE_BOTH);delete g[a]},w=!1,v=[],s=c.play=_.throttle(function(b,c,e){if(l(b)||"torrent"===b.split("?")[0].split("#")[0].split(".").pop()||m(b))if(!1!==w&&w!==b)v.push(_.toArray(arguments));else if(l(b)&&
(w=b),"undefined"===typeof k(b))h(b,function(a){s(a,c,e)});else{q(b);var f=$("#download-stats").hide();if(k(b).metadataResolved){fn.status("Connected");var r=k(b).files;if("undefined"!==typeof e&&r[e]instanceof n){_.each(g,function(c){b!==c.hash&&a(c.hash)});1!==r.length&&_.each(r,function(a,b){b===e?a._btapp.get("properties").save({priority:Btapp.TORRENT.FILE.PRIORITY.MEDIUM}):a._btapp.get("properties").save({priority:Btapp.TORRENT.FILE.PRIORITY.NO_DOWNLOAD})});var z=function(){r=k(b).files;var c=
100*r[e].downloaded/r[e].size;100<=c||"undefined"===typeof k(b)?(k(b)._btapp.get("properties").unbind("change"),f.hide(),a(b),0<v.length&&(c=v[0][0],l(c)&&"undefined"!==typeof k(c)?A(c):h(c,A))):(y(r[e].name,c,k(b).downloadSpeed,!1),f.show())},A=function(b){console.log("preloading next:",b);q(b);var c=function(){y(k(b).name,k(b).progress,k(b).downloadSpeed,!0);f.show()};k(b)._btapp.get("properties").unbind("change",c).on("change",c);var e=$("#player").data("onClose");$("#player").data("onClose",function(){a(b);
$("#keep-downloaded-files").is(":checked")||d(b);e&&e(arguments)})};k(b)._btapp.get("properties").unbind("change",z).on("change",z);var x=0,u=[],t=_.throttle(function(){u.push(k(b).downloadSpeed);10<u.length&&(u=u.slice(u.length-10));var a=_.reduce(u,function(a,b){return a+b},0)/u.length;x=Math.max(x,E(a,r[e].size,r[e].downloaded));100>=x?(fn.status("Buffering...",x+"%"),t()):(fn.status("Buffering...","100%"),fn.status(!1),C(r[e],c))},500);t()}else B(r,function(a,e){-1===e?(d(b),fn.status(!1),fn.openModal("#no-files-warning-modal")):
s(b,c,e)})}else s(b,c,e),fn.status("Connecting...")}else console.log("torrents: play: invalid hash: ",b)},500),B=function(a,b){if(1===a.length)b(a[0],0);else if(0>=a.length)b(null,-1);else{var c=$("#file-select-list").empty();_.each(a,function(d,e){var f=d.name,g=Math.round(100*d.size/1048576)/100,h=$("<div class='link navigable-item' title='"+f+"'>"+(e+1)+". "+f+"</div>"),f=$("<span class='link-info'>"+g+" MB</span>");h.on("click",function(){b(a[e],e)}).on("mousemove",function(){app.nav.paused()||
app.nav.selectElement(h)}).on("mouseout",function(){app.nav.paused()||app.nav.deselect()});c.append(h.append(f))});fn.status(!1);fn.openModal("#file-list-modal");app.nav.switchView("file-list")}},E=function(a,b,c){var d=100*c/b;return Math.max(Math.round(27E5/(b===c?0:(b-c)/a))/10,Math.round(1E3*d/app.maxBufferPercentage)/10)},y=function(a,b,c,d){c=Math.round(10*c/1024)/10;var e=$(".download-stats");e.removeClass("low med high");5.12<c&&(204.8>c?e.addClass("low"):768>c?e.addClass("med"):e.addClass("high"));
e.each(function(){var e=$(this);e.find(".download-stats-filename").html(a).attr("title",a);d?e.find(".download-stats-preloading").show():e.find(".download-stats-preloading").hide();e.find(".download-stats-progress").find(".bar").css("width",b+"%").siblings(".percentage").html(Math.round(10*b)/10+"%");e.find(".download-stats-speed").html(c+" KB/s");e=e.find(".download-stats-speed-chart");e.append("<div class='bar' data-speed='"+c+"'></div>");var f=_.reduce(e.children(),function(a,b){return Math.max($(b).attr("data-speed"),
a)},1);e.children().each(function(){$(this).height(100*$(this).attr("data-speed")/f+"%")});50<e.children().length&&e.children().first().remove()});e.show()},C=function(b,e){var f=e?e.metadata.title:b.name,g=b.name.substr(b.name.lastIndexOf(".")+1).toLowerCase();if(-1!==["mkv","mp4","avi"].indexOf(g)){var h=b.streaming_url;console.log("playing media: "+g+" file from "+h);$("#file-list-modal").is(":visible")&&($("#file-list-modal, .modal, #modal-bg, #status").hide(),$("#modal-bg").attr("data-modal",
""));app.player.projekktor.setStop&&app.player.projekktor.setStop();app.player.videojs.pause&&app.player.videojs.pause();$(".player").hide();fn.openModal("#player");$("#player").data("onClose",function(){w=!1;app.player.projekktor.setStop&&app.player.projekktor.setStop();app.player.videojs.pause&&app.player.videojs.pause();a(b.torrent);$("#keep-downloaded-files").is(":checked")||d(b.torrent);v=[]});e&&app.lists.addToList("history",e.mediaType,e);var k=$("<div id='player-overlay' style='display: none'></div>").append("<div class='overlay-title' title='"+
f+"'><a onclick='$(\"#modal-bg\").click()' style='padding-right: 20px'><i class='icon-chevron-left'></i></a>"+f+"</div>").append($("#download-stats").clone().attr("id","")),f=function(){w=!1;a(b.torrent);$("#keep-downloaded-files").is(":checked")||d(b.torrent);if(0<v.length){var e=v.shift();$("#modal-bg").click();s.apply(c.torrents,e)}};if("avi"===g){for(var g=!1,l=0;l<navigator.plugins.length;l++)if(-1!=navigator.plugins[l].name.indexOf("VLC")){g=!0;break}if(g){$("#player").attr("class","modal modal-full projekktor");
$("#video-overlay").remove();var m,g=function(){clearTimeout(m);k.is(":hidden")&&k.fadeIn();m=setTimeout(function(){k.fadeOut()},2500)};$("#projekktor-player").append(k);$("#projekktor-container").unbind("mousemove",g).on("mousemove",g);app.player.projekktor.removeListener("done",f);app.player.projekktor.addListener("done",f);app.player.projekktor.setFile(h,"video/x-msvideo");app.player.projekktor.setPlay()}else console.log("VLC Web Player is not yet installed"),fn.openModal("#vlc-install-modal")}else $("#player").attr("class",
"modal modal-full videojs"),app.player.videojs.controls(!1),app.player.videojs.on("loadeddata",function(){app.player.videojs.controls(!0)}),app.player.videojs.off("ended").on("ended",f),app.player.videojs.on("error",function(){$(".vjs-error-retry").remove();var a=$("<a class='vjs-error-retry'><i class='icon-repeat'></i></a>");a.on("click",function(){app.player.videojs.src(h).play()});$(".vjs-error-display").append(a)}),app.player.videojs.overlay({content:k.fadeIn()}),app.player.videojs.src(h).play()}},
D=c.updateAll=_.throttle(function(){app.btapp.live("torrent * properties",t)},5E3),t=function(a){"undefined"!==typeof app.btapp.get("torrent").get(a.get("hash"))&&(g[a.get("hash")]=new e({hash:a.get("hash"),url:a.get("uri")}))};c.renderList=function(a){a=a||$("<table></table>");D();var b=_.map(g,function(a){return _.pick(a,"hash","downloadSpeed","progress")});if(_.isEqual(a.data("torrent-data"),b))return a;a.data("torrent-data",b);a.empty();if(0===_.size(g))return a.append("<tr style='border: none'><td class='no-results' style='padding: 20px'>No files...</td></tr>"),
a;var c=$("<tbody></tbody>"),e=$("#torrent-list-row-template");a.append("<thead><tr><th>Name</th><th>Size</th><th>Speed</th><th>Progress</th><th></th></tr></thead>");a.data("torrents",g);_.each(g,function(a){var b=e.clone();b.find(".torrent-list-name").attr("title",a.name.replace(/['"]/g,"")).html(a.name);var f=b.find(".torrent-list-progress");f.find(".bar").width(a.progress+"%");f.find(".percentage").html(a.progress+"%");b.find(".torrent-list-speed").find("span").html(Math.round(10*a.downloadSpeed/
1024)/10+" KB/s");b.find(".torrent-list-size").find("span").html(Math.round(a.size/1073741824*100)/100+" GB");b.find(".torrent-list-name").on("click",function(){s(a.hash)});b.find(".torrent-list-open-containing").on("click",function(){k(a.hash)._btapp.open_containing()});b.find(".torrent-list-remove").on("click",function(){d(a.hash)});c.append(b)});return a.append(c)}})(window.app);
